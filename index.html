<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NN Vikings — School Days & Periods</title>
  <meta name="theme-color" content="#6b21a8">
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="icon" href="icons/icon-192.png">
  <style>
    :root{
      --bg1:#6b21a8; --bg2:#9333ea; --fg:#0b1220; --muted:#434c5e; --card:#ffffffd6; --border:#ffffff66;
      --chip:#ffffffb8; --chipText:#0b1220; --chipPast:#eceaf5; --chipNow:#fde68a; --label:#ffffffbb;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Ubuntu,"Helvetica Neue",Arial}
    body{
      background: linear-gradient(135deg,var(--bg1),var(--bg2));
      background-size: 200% 200%;
      animation: hue 16s ease-in-out infinite;
      color:var(--fg);
    }
    @keyframes hue{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
    .wrap{max-width:980px;margin:0 auto;padding:18px}
    .brand{color:#fff;letter-spacing:.08em;font-weight:800;text-transform:uppercase;margin:0 0 8px;opacity:.9;font-size:14px}
    .card{
      background: var(--card);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      border:1px solid var(--border);
      border-radius:18px;
      box-shadow: 0 14px 40px rgba(0,0,0,0.18);
      padding:16px 16px 14px;
    }
    h1{font-size:clamp(26px,6.2vw,56px); line-height:1.07;margin:0 0 6px;font-weight:900;letter-spacing:-0.02em;}
    .sub{font-size:clamp(14px,2.6vw,18px); color:#0b1220; opacity:.95; line-height:1.25}
    .grid{display:grid;grid-template-columns:1fr 1fr; gap:10px; margin-top:6px}
    @media (max-width:780px){ .grid{grid-template-columns:1fr;} }
    .row{padding:6px 0}
    .chips{display:flex;flex-wrap:wrap;gap:6px;margin-top:6px}
    .chip{background:var(--chip); color:var(--chipText); border-radius:999px; padding:6px 10px; border:1px solid var(--border); font-size:12px; line-height:1}
    .chip.past{background:var(--chipPast)}
    .chip.now{background:var(--chipNow); font-weight:700}
    .small{font-size:12px;margin-top:10px;color:#0b1220}
    .btns{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    button{font-size:14px;padding:6px 10px;border-radius:10px;border:1px solid var(--border);background:#fff;cursor:pointer}
    button:active{transform:translateY(1px)}
    .mode-pill{display:inline-block;background:var(--label); border:1px solid var(--border); border-radius:999px; padding:4px 10px; font-size:12px; margin-left:6px}
  </style>
</head>
<body>
  <div class="wrap">
    <h3 class="brand">NN Vikings</h3>
    <div class="card">
      <h1 id="topline">Loading…</h1>

      <div class="grid">
        <div class="row sub" id="today"></div>
        <div class="row sub" id="next"></div>
      </div>

      <!-- Shows "Wednesday schedule" or "Special schedule" when applicable -->
      <div class="row sub" id="modeRow"></div>

      <!-- Period chips (past/now/upcoming) -->
      <div class="chips" id="chips"></div>

      <div class="btns">
        <button id="refreshBtn">Refresh now</button>
        <button id="copyBtn">Copy details</button>
      </div>
      <div class="small" id="range"></div>
    </div>
  </div>

<script>
/* =====================
   CALENDAR SETTINGS
   ===================== */
const FIRST_DAY = new Date(2025, 7, 12); // Aug 12, 2025
const LAST_DAY  = new Date(2026, 4, 21); // May 21, 2026
const NON_ATTENDANCE = [
  ["Teacher Institute",      2025,7,11,  2025,7,11],
  ["Labor Day",              2025,8,1,   2025,8,1 ],
  ["Indigenous Peoples Day", 2025,9,13,  2025,9,13],
  ["Teacher Institute",      2025,9,31,  2025,9,31],
  ["Thanksgiving Break",     2025,10,26, 2025,10,28],
  ["Winter Break",           2025,11,22, 2026,0,2 ],
  ["Martin Luther King Day", 2026,0,19,  2026,0,19],
  ["Presidents’ Day",        2026,1,16,  2026,1,16],
  ["Teacher Institute",      2026,2,13,  2026,2,13],
  ["Spring Break",           2026,2,30,  2026,3,3 ],
];

/* =====================
   BELL SCHEDULES
   ===================== */
/* Default (Mon, Tue, Thu, Fri) */
const SCHEDULE_DEFAULT = [
  { id:"01", label:"Period 01", start:[8,10],  end:[8,52],  include:true },
  { id:"02", label:"Period 02", start:[8,57],  end:[9,39],  include:true },
  { id:"03", label:"Period 03", start:[9,44],  end:[10,26], include:true },
  { id:"HR", label:"Homeroom",  start:[10,31], end:[10,41], include:false },
  { id:"04", label:"Period 04", start:[10,46], end:[11,28], include:true },
  { id:"05", label:"Period 05", start:[11,33], end:[12,15], include:true },
  { id:"06", label:"Period 06", start:[12,20], end:[13,2],  include:true },
  { id:"07", label:"Period 07", start:[13,7],  end:[13,49], include:true },
  { id:"08", label:"Period 08", start:[13,54], end:[14,36], include:true },
  { id:"09", label:"Period 09", start:[14,41], end:[15,23], include:true },
];
/* Wednesday schedule */
const SCHEDULE_WED = [
  { id:"01", label:"Period 01", start:[9,40],  end:[10,14], include:true },
  { id:"02", label:"Period 02", start:[10,19], end:[10,52], include:true },
  { id:"03", label:"Period 03", start:[10,57], end:[11,31], include:true },
  { id:"04", label:"Period 04", start:[11,36], end:[12,10], include:true },
  { id:"05", label:"Period 05", start:[12,15], end:[12,49], include:true },
  { id:"06", label:"Period 06", start:[12,54], end:[13,28], include:true },
  { id:"07", label:"Period 07", start:[13,33], end:[14,7],  include:true },
  { id:"08", label:"Period 08", start:[14,12], end:[14,45], include:true },
  { id:"09", label:"Period 09", start:[14,50], end:[15,23], include:true },
];

// If you only want to count certain sections, list period IDs here; otherwise all include:true are counted
const INCLUDE_ONLY = null;

/* Optional date-specific overrides (e.g., assemblies)
   Example: { '2025-11-05': SCHEDULE_WED }
*/
const SPECIAL_DATES = {};

const oneDay = 24*60*60*1000;
const iso     = d => d.toLocaleDateString(undefined,{weekday:'long', month:'short', day:'2-digit', year:'numeric'});
const shortMD = d => d.toLocaleDateString(undefined,{month:'short', day:'2-digit'});
const toKey   = d => d.toISOString().slice(0,10);

/* ===== Helpers ===== */
function* dateRange(start, end){
  const s = new Date(start); s.setHours(0,0,0,0);
  const e = new Date(end);   e.setHours(0,0,0,0);
  for(let t = s.getTime(); t <= e.getTime(); t += oneDay){
    const d = new Date(t);
    d.setHours(0,0,0,0);
    yield d;
  }
}
function isWeekday(d){ return d.getDay() >= 1 && d.getDay() <= 5; }
function buildNonAttendanceMap(){
  const m = new Map();
  for(const [label, sy, sm, sd, ey, em, ed] of NON_ATTENDANCE){
    const s = new Date(sy, sm, sd), e = new Date(ey, em, ed);
    for(const d of dateRange(s,e)) m.set(+d, label);
  }
  return m;
}
function allSchoolDays(){
  const na = buildNonAttendanceMap();
  const days = [];
  for(const d of dateRange(FIRST_DAY, LAST_DAY)){
    if(isWeekday(d) && !na.has(+d)) days.push(new Date(d));
  }
  return days;
}
function fullDaysAfterToday(today = new Date()){
  today.setHours(0,0,0,0);
  return allSchoolDays().filter(d => d.getTime() > today.getTime()).length;
}
function todayStatus(today = new Date()){
  today.setHours(0,0,0,0);
  const na = buildNonAttendanceMap();
  if(today < FIRST_DAY) return ["Not started", null];
  if(today > LAST_DAY)  return ["Completed", null];
  const key = +today;
  if(na.has(key)) return [`No school: ${na.get(key)}`, na.get(key)];
  if(!isWeekday(today)) return ["No school: Weekend", "Weekend"];
  return ["School day", null];
}

/* ===== Period helpers ===== */
function scheduleForDate(baseDate){
  const y = baseDate.getFullYear(), m = baseDate.getMonth(), d = baseDate.getDate();
  const key = toKey(baseDate);
  let base = SPECIAL_DATES[key] || (baseDate.getDay() === 3 ? SCHEDULE_WED : SCHEDULE_DEFAULT);
  const useOnly = Array.isArray(INCLUDE_ONLY) ? new Set(INCLUDE_ONLY) : null;
  return base.map(p => ({
    ...p,
    startDate: new Date(y, m, d, p.start[0], p.start[1]),
    endDate:   new Date(y, m, d, p.end[0],   p.end[1]),
    _count: useOnly ? useOnly.has(p.id) : !!p.include
  }));
}
function remainingPeriodsToday(now = new Date()){
  const sched = scheduleForDate(now);
  return sched.filter(p => p._count && p.endDate.getTime() > now.getTime()).length;
}

/* ===== UI ===== */
function plural(n, s, p){ return `${n} ${n===1?s:p}`; }

function buildChips(now = new Date()){
  const chips = document.getElementById('chips');
  chips.innerHTML = "";
  const sched = scheduleForDate(now);
  for(const p of sched){
    if(!p._count) continue;
    let cls = "chip";
    if(p.endDate.getTime() <= now.getTime()) cls += " past";
    else if(p.startDate.getTime() <= now.getTime()) cls += " now";
    const txt = `${p.label} ${p.startDate.toLocaleTimeString([], {hour:'numeric', minute:'2-digit'})}–${p.endDate.toLocaleTimeString([], {hour:'numeric', minute:'2-digit'})}`;
    const el = document.createElement('span');
    el.className = cls; el.textContent = txt;
    chips.appendChild(el);
  }
  // Mode label (Wednesday / Special)
  const mode = (toKey(now) in SPECIAL_DATES) ? "Special schedule"
             : (now.getDay()===3 ? "Wednesday schedule" : "");
  const row = document.getElementById('modeRow');
  row.innerHTML = mode ? `<span class="mode-pill">${mode}</span>` : "";
}

function render(){
  const now = new Date(); now.setSeconds(0,0);
  const today = new Date(now); today.setHours(0,0,0,0);

  // Top line: days EXCLUDING today + periods left TODAY
  const daysExclToday = fullDaysAfterToday(today);
  const periodsToday  = (todayStatus(today)[0] === "School day") ? remainingPeriodsToday(now) : 0;
  document.getElementById('topline').textContent =
    `${plural(daysExclToday,'day','days')} and ${plural(periodsToday,'period','periods')} left`;

  const [status] = todayStatus(today);
  document.getElementById('today').textContent = `Today: ${status}  (${iso(today)})`;

  // Next break
  const na = buildNonAttendanceMap();
  const start = new Date(Math.max(today, FIRST_DAY));
  let msg = "Next break: None — approaching the end of the year";
  for(const d of dateRange(start, LAST_DAY)){
    if(na.has(+d)){
      const label = na.get(+d);
      let end = new Date(d);
      for(const f of dateRange(new Date(+d+oneDay), LAST_DAY)){
        if(na.get(+f) === label){ end = f; } else { break; }
      }
      msg = (d.getTime()===end.getTime())
        ? `Next break: ${label} on ${iso(d).replace(/, \d{4}$/,'')}`
        : `Next break: ${label} (${shortMD(d)}–${shortMD(end)})`;
      break;
    }
  }
  document.getElementById('next').textContent = msg;

  buildChips(now);
  document.getElementById('range').textContent =
    `School year: ${iso(FIRST_DAY).replace(/, \d{4}$/,'')} — ${iso(LAST_DAY).replace(/^[A-Za-z]+, /,'')}`;
}

document.getElementById('refreshBtn').addEventListener('click', render);
document.getElementById('copyBtn').addEventListener('click', () => {
  const now = new Date(); now.setSeconds(0,0);
  const today = new Date(now); today.setHours(0,0,0,0);
  const daysExclToday = fullDaysAfterToday(today);
  const periodsToday  = (todayStatus(today)[0] === "School day") ? remainingPeriodsToday(now) : 0;
  const lines = [];
  lines.push(`${daysExclToday} days and ${periodsToday} periods left`);
  const [status] = todayStatus(today);
  lines.push(`Today: ${status} (${iso(today)})`);
  lines.push(document.getElementById('next').textContent);
  lines.push(document.getElementById('range').textContent);
  navigator.clipboard?.writeText(lines.join("\n"));
});

if('serviceWorker' in navigator){
  navigator.serviceWorker.register('./sw.js').catch(()=>{});
}

render();
</script>
</body>
</html>
